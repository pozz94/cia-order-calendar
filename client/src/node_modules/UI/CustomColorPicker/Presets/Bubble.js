import React, { Component } from "react";
import Wrapper from "../Components/Wrapper";
import Display from "../Components/Display";
import Swatches from "../Components/Swatches";
import HueSlider from "../Components/Sliders/HSLHue";
import SaturationSlider from "../Components/Sliders/HSLSaturation";
import LightnessSlider from "../Components/Sliders/HSLLightness";
import Text from "../Components/Text"
import Theme from "./BubbleTheme.module.css";
import {optimalTextColor} from "../Components/utils/colorHelper";
import Context from "../Components/Context"

class Bubble extends Component{
	constructor(props){
		super(props);
		this.state = {
			active: false
		};
		this.wrapper = React.createRef();
	}

	closeBubble = (e) => {
		if (!this.wrapper.current.contains(e.target)) {
			document.removeEventListener('click', this.closeBubble, false);
			this.setState({ active: false });
		}
	}

	openBubble = () => {
		this.setState({ active: true });
		document.addEventListener('click', this.closeBubble, false);
	}

	render = () => (
		< Wrapper
			defaultColor={this.props.defaultColor}
			theme={Theme}
			onChange={this.props.onChange}
			format={this.props.format}
		>
			<Display
				className={[Theme.bubbleButton, (this.state.active)?Theme.active:null ].join(" ")}
				onClick={this.openBubble}
			>
				{this.props.children}
				<div className={Theme.bubbleWrapper} ref={this.wrapper}>
					<Display className={Theme.bubbleArrow} />
					<Display className={Theme.bubbleDisplay}>
						<pre>
							<Context.Consumer>{context=>
								<Text
									className={Theme.bubbleText}
									style={{ color: optimalTextColor(context.rgb) }}
								/>
							}</Context.Consumer>
						</pre>
					</Display>
					<HueSlider />
					<SaturationSlider />
					<LightnessSlider />
					<Swatches colors={this.props.colors} />
				</div>
			</Display>
		</Wrapper >
	);
}


export default Bubble;