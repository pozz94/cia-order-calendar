import fetch from "node-fetch";

const getJson = (url) => {	
	return fetch(url).then(fetched=>processJsonResponse(fetched)).then(json=>json);
}

const postJson = (url, obj) => {
	return fetch(url, {
		method: "POST",
		headers: {
			Accept: "application/json",
			"Content-Type": "application/json"
		},
		body: JSON.stringify(obj)
	}).then(fetched=>processJsonResponse(fetched)).then(json=>json);
}

const putJson = (url, obj) => {
	return fetch(url, {
		method: "PUT",
		headers: {
			Accept: "application/json",
			"Content-Type": "application/json"
		},
		body: JSON.stringify(obj)
	}).then(fetched=>processJsonResponse(fetched)).then(json=>json);
}

const patchJson = (url, obj) => {
	return fetch(url, {
		method: "PATCH",
		headers: {
			Accept: "application/json",
			"Content-Type": "application/json"
		},
		body: JSON.stringify(obj)
	}).then(fetched=>processJsonResponse(fetched)).then(json=>json);
}

const deleteJson = (url) => {
	return fetch(url, {
		method: "DELETE"
	}).then(fetched=>processJsonResponse(fetched)).then(json=>json);
}

const processJsonResponse = response => {
	const type = response.headers.get("Content-Type");
	if (type && type.includes("application/json")) {
		return response.json();
	}
	throw new TypeError("Oops, we haven't got JSON!");
}

export { getJson, postJson, putJson, patchJson, deleteJson };