import DB from "DB";

const queryExists = (query, props = [], exists, doesnt) => {
	DB.getCon().query(query, props, (err, rows, fields) => {
		if (err) {
			console.log("[mysql error]", err);
			//res.status(500).json({error: "mysql error"});
		}
		else {
			if (rows.length > 0) {
				exists(rows, fields);
			}
			else {
				doesnt(rows, fields);
			}
		}
	});
	DB.end();
}

const query = (query, props = [], process) => {
	DB.getCon().query(query, props, (err, rows, fields) => {
		if (err) {
			console.log("[mysql error]", err);
			//res.status(500).json({error: "mysql error"});
		} else {
			process(rows, fields);
		}
	});
	DB.end();
}

const queryPromise = (q, props = []) =>
	new Promise((resolve, reject) => {
		DB.getCon().query(q, props, (err, results, fields) => {
			if (err) {
				reject("[mysql error] " + err);
			} else {
				resolve(results);
			}
		})
	});

export { query, queryExists, queryPromise };